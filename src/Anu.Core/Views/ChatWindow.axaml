<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:viewModels="clr-namespace:Anu.Core.ViewModels"
        xmlns:views="clr-namespace:Anu.Core.Views"
        xmlns:converters="clr-namespace:Anu.Core.Converters"
        x:Class="Anu.Core.Views.ChatWindow"
        x:DataType="viewModels:ChatWindowViewModel"
        MinWidth="450"
        MaxWidth="560"
        MinHeight="150"
        SizeToContent="WidthAndHeight">
    
    <Window.Resources>
        <converters:MessageRequestedToIconConverter x:Key="MessageRequestedToIconConverter" />
    </Window.Resources>
    
    <Panel>
            <Image Source="{Binding ImageSource}"
                   Stretch="Uniform"
                   MaxWidth="240"
                   MaxHeight="135"
                   HorizontalAlignment="Right"
                   VerticalAlignment="Top"
                   Margin="5"/>

            <Rectangle Fill="White"
                       RadiusX="20"
                       RadiusY="20"
                       Stretch="Fill"
                       IsVisible="{Binding IgnoreMouseEvents}"
                       Opacity="{Binding ChatBoxOpacity}"/>
            <StackPanel>

                <Border Height="28" PointerPressed="TitleBar_PointerPressed" Background="Transparent">
                    <!-- <Button> -->
                    <!--     <PathIcon Data=""/> -->
                    <!-- </Button> -->
                </Border>
                
                <views:CustomMarkdownScrollViewer Name="ChatView"
                                                  SelectionEnabled="True"
                                                  HorizontalAlignment="Stretch"
                                                  VerticalAlignment="Stretch"
                                                  Markdown="{Binding MdText}"
                                                  ScrollValue="{Binding MarkdownScrollValue, Mode=TwoWay}">
                    <views:CustomMarkdownScrollViewer.Styles>
                        <StyleInclude Source="../Styles/MarkdownStyles.axaml" />
                    </views:CustomMarkdownScrollViewer.Styles>
                </views:CustomMarkdownScrollViewer>
    
                <Border Background="White" CornerRadius="20" BorderBrush="LightGray" BorderThickness="1" Padding="8" VerticalAlignment="Bottom">
                    <Grid RowDefinitions="Auto,*">
                        <TextBox Grid.Row="0" 
                                 Name="UserPrompt"
                                 MaxHeight="250"
                                 MinHeight="40"
                                 Watermark="Ask me anything..."
                                 TextWrapping="Wrap"
                                 Text="{Binding UserMessage}"
                                 AcceptsReturn="True"
                                 BorderThickness="0"
                                 HorizontalAlignment="Stretch"
                                 VerticalContentAlignment="Center">
                            <TextBox.Styles>
                                <Style Selector="TextBox:focus /template/ Border#PART_BorderElement">
                                    <Setter Property="BorderBrush" Value="Transparent"/>
                                </Style>
                            </TextBox.Styles>
                            <TextBox.KeyBindings>
                                <KeyBinding Command="{Binding SendMessage}" Gesture="Enter" />
                            </TextBox.KeyBindings>
                        </TextBox>
                        <Grid Grid.Row="1" ColumnDefinitions="Auto,*,Auto" HorizontalAlignment="Stretch" VerticalAlignment="Bottom">
                            <Button Grid.Column="0"
                                    CornerRadius="100"
                                    Margin="4"
                                    Background="Transparent"
                                    ToolTip.Tip="Attach"
                                    HorizontalAlignment="Left"
                                    VerticalAlignment="Center">
                                <Button.Flyout>
                                    <MenuFlyout Placement="Top">
                                        <MenuItem Header="Image from clipboard" Command="{Binding ReadClipboardImage}">
                                        <MenuItem.Icon>
                                            <PathIcon Data="M4.50678 6.00782C3.60124 6.58285 3 7.59621 3 8.75V19.25C3 22.1495 5.35051 24.5 8.25 24.5H18.75C19.9038 24.5 20.9172 23.8988 21.4939 22.9925L21.3717 22.9982L21.25 23H8.25C6.17893 23 4.5 21.3211 4.5 19.25V6.25C4.5 6.16872 4.50228 6.08798 4.50678 6.00782ZM8.75 3C6.95507 3 5.5 4.45507 5.5 6.25V18.75C5.5 20.5449 6.95507 22 8.75 22H21.25C23.0449 22 24.5 20.5449 24.5 18.75V6.25C24.5 4.45507 23.0449 3 21.25 3H8.75ZM8.16845 20.4011L14.4754 14.2231C14.7405 13.9635 15.1501 13.9399 15.4414 14.1523L15.525 14.2231L21.8315 20.4011C21.6496 20.4651 21.4539 20.5 21.25 20.5H8.75C8.54613 20.5 8.3504 20.4651 8.16845 20.4011L14.4754 14.2231L8.16845 20.4011ZM8.75 4.5H21.25C22.2165 4.5 23 5.2835 23 6.25V18.75C23 18.958 22.9637 19.1576 22.8971 19.3427L16.5746 13.1515C15.7415 12.3355 14.4327 12.2967 13.5543 13.0349L13.4259 13.1515L7.10326 19.3437C7.03643 19.1583 7 18.9584 7 18.75V6.25C7 5.2835 7.7835 4.5 8.75 4.5ZM11.4996 7.75116C10.8096 7.75116 10.2503 8.31048 10.2503 9.00045C10.2503 9.69041 10.8096 10.2497 11.4996 10.2497C12.1895 10.2497 12.7488 9.69041 12.7488 9.00045C12.7488 8.31048 12.1895 7.75116 11.4996 7.75116Z"/>
                                        </MenuItem.Icon>
                                        </MenuItem>
                                        <MenuItem Header="Screenshot window" Command="{Binding TakeScreenshot}">
                                            <MenuItem.Icon>
                                                <PathIcon Data="M17.25,3 C19.3210678,3 21,4.67893219 21,6.75 L21,17.25 C21,19.3210678 19.3210678,21 17.25,21 L6.75,21 C4.67893219,21 3,19.3210678 3,17.25 L3,6.75 C3,4.67893219 4.67893219,3 6.75,3 L17.25,3 Z M17.25,4.5 L6.75,4.5 C5.50735931,4.5 4.5,5.50735931 4.5,6.75 L4.5,17.25 C4.5,18.4926407 5.50735931,19.5 6.75,19.5 L17.25,19.5 C18.4926407,19.5 19.5,18.4926407 19.5,17.25 L19.5,6.75 C19.5,5.50735931 18.4926407,4.5 17.25,4.5 Z M17.25,13 C17.6642136,13 18,13.3357864 18,13.75 L18,16 C18,17.1046 17.1046,18 16,18 L13.75,18 C13.3357864,18 13,17.6642136 13,17.25 C13,16.8357864 13.3357864,16.5 13.75,16.5 L16,16.5 C16.2761,16.5 16.5,16.2761 16.5,16 L16.5,13.75 C16.5,13.3357864 16.8357864,13 17.25,13 Z M6.75,13 C7.16421356,13 7.5,13.3357864 7.5,13.75 L7.5,16 C7.5,16.2761 7.72386,16.5 8,16.5 L10.25,16.5 C10.6642136,16.5 11,16.8357864 11,17.25 C11,17.6642136 10.6642136,18 10.25,18 L8,18 C6.89543,18 6,17.1046 6,16 L6,13.75 C6,13.3357864 6.33578644,13 6.75,13 Z M8,6 L10.25,6 C10.6642136,6 11,6.33578644 11,6.75 C11,7.12969577 10.7178461,7.44349096 10.3517706,7.49315338 L10.25,7.5 L8,7.5 C7.75454222,7.5 7.5503921,7.67687704 7.50805575,7.91012499 L7.5,8 L7.5,10.25 C7.5,10.6642136 7.16421356,11 6.75,11 C6.37030423,11 6.05650904,10.7178461 6.00684662,10.3517706 L6,10.25 L6,8 C6,6.94563773 6.81587733,6.08183483 7.85073759,6.00548573 L8,6 L10.25,6 L8,6 Z M16,6 C17.1046,6 18,6.89543 18,8 L18,10.25 C18,10.6642136 17.6642136,11 17.25,11 C16.8357864,11 16.5,10.6642136 16.5,10.25 L16.5,8 C16.5,7.72386 16.2761,7.5 16,7.5 L13.75,7.5 C13.3357864,7.5 13,7.16421356 13,6.75 C13,6.33578644 13.3357864,6 13.75,6 L16,6 Z"/>
                                            </MenuItem.Icon>
                                        </MenuItem>
                                    </MenuFlyout>
                                </Button.Flyout>
                                <PathIcon Data="M11.7715948,3.74348899 C14.113054,1.39990252 17.9120439,1.39990252 20.2551897,3.74304827 C22.5382548,6.02611336 22.5967949,9.69132107 20.4308101,12.0452653 L20.2426506,12.2426307 L11.4426304,21.0408404 L11.4426304,21.0408404 L11.4060613,21.0710739 C9.94482388,22.3878538 7.69082246,22.3431052 6.28344814,20.9357309 C4.96443071,19.6167134 4.84231478,17.5540367 5.91710035,16.0973219 C5.94044402,16.0519637 5.96869088,16.0082157 6.00190455,15.9670689 L6.0554581,15.9074233 L6.14236585,15.819689 L6.28344814,15.671807 L6.28636585,15.674689 L13.7221045,8.22037508 C13.9880171,7.95375494 14.4046482,7.92899525 14.6985489,8.14645937 L14.7827638,8.21896569 C15.0493839,8.4848782 15.0741436,8.90150935 14.8566795,9.19541007 L14.7841732,9.27962492 L7.18955772,16.8927175 C6.471921,17.7683146 6.52180093,19.0625849 7.33919752,19.8799815 C8.16826244,20.7090464 9.48791296,20.7485257 10.3637003,19.9984193 L19.1963769,11.1679575 L19.1963769,11.1679575 C20.9518888,9.41031016 20.9518888,6.56106776 19.1945295,4.80370845 C17.4920877,3.10126661 14.7649391,3.0480653 12.9984531,4.64410452 L12.8305685,4.80370845 L12.8180195,4.81801948 L3.28169594,14.354343 C2.98880272,14.6472363 2.51392898,14.6472363 2.22103577,14.354343 C1.9547692,14.0880765 1.93056315,13.6714128 2.14841761,13.3778013 L2.22103577,13.2936829 L11.7699083,3.74304827 L11.7715948,3.74348899 Z"/>
                            </Button>
                            <StackPanel Grid.Column="1" Orientation="Horizontal">
                                
                                <ToggleButton IsChecked="{Binding Reasoning}"
                                                     ToolTip.Tip="Enable Reasoning"
                                                     Margin="4"
                                                     Background="Transparent"
                                                     CornerRadius="100"
                                                     HorizontalAlignment="Left"
                                                     VerticalAlignment="Center"
                        >
                            <PathIcon Data="M12.000008,2.00139734 C16.0040628,2.00139734 19.249992,5.24733208 19.249992,9.25139734 C19.249992,11.3474567 18.3493333,13.2711054 16.5869535,14.9933011 C16.5100054,15.0685004 16.450441,15.1590617 16.4118457,15.2586031 L16.380373,15.3609016 L15.2492957,20.256497 C15.0265913,21.2204195 14.2034707,21.9187611 13.2302558,21.9933796 L13.0570456,22 L10.9432689,22 C9.95374997,22 9.08791486,21.3549492 8.79629808,20.4232534 L8.75088874,20.2559339 L7.62132399,15.3611533 C7.58904306,15.2212595 7.51728321,15.0935695 7.41456824,14.9932517 C5.73516207,13.3530399 4.83779011,11.5301519 4.75613429,9.54965138 L4.750008,9.25139734 L4.75388322,9.01208292 C4.88014853,5.11879041 8.07602134,2.00139734 12.000008,2.00139734 Z M14.115008,18.4993973 L9.884008,18.4993973 L10.2124755,19.9186446 C10.2831529,20.2249131 10.5356676,20.4507962 10.8400612,20.4929101 L10.9432689,20.5 L13.0570456,20.5 C13.3712985,20.5 13.6481364,20.3048226 13.757662,20.0177756 L13.7877956,19.9188323 L14.115008,18.4993973 Z M12.000008,3.50139734 C8.89821922,3.50139734 6.37007083,5.95741111 6.25416008,9.03084139 L6.250008,9.25139734 L6.25672343,9.52840679 C6.33286953,11.0917695 7.05722352,12.5475342 8.46263227,13.9201432 C8.72676013,14.1781068 8.92266257,14.4964075 9.03423135,14.8463815 L9.08291336,15.0238752 L9.538008,16.9993973 L14.461008,16.9993973 L14.9188729,15.023237 C15.0019011,14.6638694 15.1717664,14.3313677 15.4124215,14.0542893 L15.5385739,13.9205009 C16.9431998,12.547902 17.6671738,11.0920338 17.7432801,9.5284475 L17.749992,9.25139734 L17.7458399,9.03084154 C17.6299293,5.9574132 15.1017833,3.50139734 12.000008,3.50139734 Z"/>
                        </ToggleButton>
                                <ToggleButton IsChecked="{Binding ComputerUse}"
                                              ToolTip.Tip="Computer Use"
                                              Margin="4"
                                              Background="Transparent"
                                              CornerRadius="100"
                                              HorizontalAlignment="Left"
                                              VerticalAlignment="Center"
                                >
                            <PathIcon Data="M6.24961 6C5.00697 6 3.99961 7.00736 3.99961 8.25V17.25C3.99961 18.4926 5.00696 19.5 6.24961 19.5H21.7504C22.993 19.5 24.0004 18.4926 24.0004 17.25V8.25C24.0004 7.00736 22.993 6 21.7504 6H6.24961ZM5.49961 8.25C5.49961 7.83579 5.83539 7.5 6.24961 7.5H21.7504C22.1646 7.5 22.5004 7.83579 22.5004 8.25V17.25C22.5004 17.6642 22.1646 18 21.7504 18H6.24961C5.83539 18 5.49961 17.6642 5.49961 17.25V8.25Z M2.75 20.5C2.33579 20.5 2 20.8358 2 21.25C2 21.6642 2.33579 22 2.75 22H25.25C25.6642 22 26 21.6642 26 21.25C26 20.8358 25.6642 20.5 25.25 20.5H2.75Z"/>
                        </ToggleButton>
                        
                            </StackPanel>
                            <Button Grid.Column="2" 
                                    Command="{Binding SendOrStop}"
                                    Margin="4"
                                    CornerRadius="100"
                                    Background="Black"
                                    HorizontalAlignment="Right"
                                    VerticalAlignment="Center"
                            >
                                <Button.Styles>
                                    <Style Selector="Button:pointerover /template/ ContentPresenter">
                                        <Setter Property="Background" Value="Black"></Setter>
                                    </Style>
                                </Button.Styles>
                                <PathIcon Foreground="White" Data="{Binding MessageRequested, Converter={StaticResource MessageRequestedToIconConverter}}"/>
                            </Button>
                        </Grid>
                            
                    </Grid>
                    </Border>
            </StackPanel>
        </Panel>
</Window>
